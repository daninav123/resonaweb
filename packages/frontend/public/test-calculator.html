<!DOCTYPE html>
<html>
<head>
    <title>Test Calculadora - Diagn√≥stico Completo</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .test { margin: 10px 0; padding: 10px; border-left: 3px solid #666; }
        .pass { border-color: #4ec9b0; background: #0d3d30; }
        .fail { border-color: #f48771; background: #3d1d1d; }
        .info { border-color: #569cd6; background: #1d2d3d; }
        button { background: #007acc; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
        button:hover { background: #005a9e; }
        pre { background: #252526; padding: 10px; overflow: auto; }
        h2 { color: #4ec9b0; }
    </style>
</head>
<body>
    <h1>üß™ Diagn√≥stico Completo de Calculadora</h1>
    
    <button onclick="runAllTests()">üöÄ Ejecutar Todos los Tests</button>
    <button onclick="fixAll()">üîß Reparar Todo</button>
    <button onclick="location.href='/admin/calculator'">üìä Ir al Gestor</button>
    
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runAllTests() {
            results.innerHTML = '<h2>Ejecutando Tests...</h2>';
            
            // Test 1: Verificar localStorage
            log('<h3>Test 1: Verificar localStorage</h3>');
            const saved = localStorage.getItem('advancedCalculatorConfig');
            if (!saved) {
                log('‚ùå No hay configuraci√≥n guardada', 'fail');
                return;
            }
            log('‚úÖ Configuraci√≥n encontrada', 'pass');

            // Test 2: Parsear configuraci√≥n
            log('<h3>Test 2: Parsear Configuraci√≥n</h3>');
            let config;
            try {
                config = JSON.parse(saved);
                log('‚úÖ JSON v√°lido', 'pass');
            } catch (e) {
                log('‚ùå Error al parsear: ' + e.message, 'fail');
                return;
            }

            // Test 3: Verificar estructura
            log('<h3>Test 3: Verificar Estructura</h3>');
            if (!config.eventTypes || !Array.isArray(config.eventTypes)) {
                log('‚ùå eventTypes no es un array', 'fail');
                return;
            }
            log(`‚úÖ eventTypes es un array con ${config.eventTypes.length} elementos`, 'pass');

            // Test 4: Verificar cada evento
            log('<h3>Test 4: Verificar Eventos y Partes</h3>');
            let allGood = true;
            config.eventTypes.forEach((event, i) => {
                const hasParts = event.parts && Array.isArray(event.parts);
                const partsCount = hasParts ? event.parts.length : 0;
                
                if (!hasParts || partsCount === 0) {
                    log(`‚ùå ${event.icon} ${event.name}: SIN PARTES o parts no es array`, 'fail');
                    allGood = false;
                } else {
                    log(`‚úÖ ${event.icon} ${event.name}: ${partsCount} partes`, 'pass');
                    event.parts.forEach(part => {
                        const hasRequiredFields = part.id && part.name && part.icon && 
                                                 part.soundLevel && part.lightingLevel;
                        if (!hasRequiredFields) {
                            log(`  ‚ö†Ô∏è Parte "${part.name}" tiene campos faltantes`, 'fail');
                            allGood = false;
                        }
                    });
                }
            });

            // Test 5: Verificar precios
            log('<h3>Test 5: Verificar Precios</h3>');
            if (!config.servicePrices || !config.servicePrices.sound || !config.servicePrices.lighting) {
                log('‚ùå Precios de servicios faltantes', 'fail');
                allGood = false;
            } else {
                log('‚úÖ Precios configurados correctamente', 'pass');
            }

            // Resultado final
            if (allGood) {
                log('<h2 style="color: #4ec9b0;">‚úÖ TODOS LOS TESTS PASARON</h2>', 'pass');
                log('<p>La configuraci√≥n es correcta. Si no ves las partes, el problema est√° en el componente React.</p>', 'info');
            } else {
                log('<h2 style="color: #f48771;">‚ùå TESTS FALLIDOS</h2>', 'fail');
                log('<p>Click en "üîß Reparar Todo" para arreglar la configuraci√≥n</p>', 'info');
            }

            // Mostrar configuraci√≥n completa
            log('<h3>Configuraci√≥n Actual:</h3>');
            log('<pre>' + JSON.stringify(config, null, 2) + '</pre>');
        }

        function fixAll() {
            results.innerHTML = '<h2>üîß Reparando Configuraci√≥n...</h2>';

            // Configuraci√≥n correcta con TODAS las partes
            const fixedConfig = {
                eventTypes: [
                    {
                        id: 'boda',
                        name: 'Boda',
                        icon: 'üíí',
                        multiplier: 1.5,
                        parts: [
                            { id: 'ceremony', name: 'Ceremonia', icon: 'üíí', description: 'Ceremonia religiosa o civil', defaultDuration: 1, soundLevel: 'professional', lightingLevel: 'basic' },
                            { id: 'cocktail', name: 'C√≥ctel', icon: 'üç∏', description: 'Aperitivo y bebidas entre ceremonia y banquete', defaultDuration: 2, soundLevel: 'intermediate', lightingLevel: 'intermediate' },
                            { id: 'banquet', name: 'Banquete', icon: 'üçΩÔ∏è', description: 'Comida o cena principal', defaultDuration: 4, soundLevel: 'professional', lightingLevel: 'professional' },
                            { id: 'disco', name: 'Disco/Fiesta', icon: 'üéµ', description: 'M√∫sica y baile despu√©s del banquete', defaultDuration: 4, soundLevel: 'premium', lightingLevel: 'premium' }
                        ]
                    },
                    {
                        id: 'conferencia',
                        name: 'Conferencia',
                        icon: 'üé§',
                        multiplier: 1.2,
                        parts: [
                            { id: 'registration', name: 'Registro', icon: 'üìã', description: 'Acreditaci√≥n de asistentes', defaultDuration: 1, soundLevel: 'none', lightingLevel: 'basic' },
                            { id: 'presentations', name: 'Ponencias', icon: 'üé§', description: 'Charlas y presentaciones principales', defaultDuration: 4, soundLevel: 'professional', lightingLevel: 'professional' },
                            { id: 'coffee-break', name: 'Coffee Break', icon: '‚òï', description: 'Descanso y networking', defaultDuration: 0.5, soundLevel: 'basic', lightingLevel: 'basic' }
                        ]
                    },
                    {
                        id: 'concierto',
                        name: 'Concierto',
                        icon: 'üéµ',
                        multiplier: 1.8,
                        parts: [
                            { id: 'soundcheck', name: 'Prueba de Sonido', icon: 'üîß', description: 'Preparaci√≥n t√©cnica y ajustes', defaultDuration: 2, soundLevel: 'premium', lightingLevel: 'professional' },
                            { id: 'concert', name: 'Concierto', icon: 'üéµ', description: 'Actuaci√≥n principal', defaultDuration: 3, soundLevel: 'premium', lightingLevel: 'premium' }
                        ]
                    },
                    {
                        id: 'corporativo',
                        name: 'Evento Corporativo',
                        icon: 'üíº',
                        multiplier: 1.3,
                        parts: [
                            { id: 'welcome', name: 'Bienvenida', icon: 'üëã', description: 'Recepci√≥n inicial', defaultDuration: 0.5, soundLevel: 'basic', lightingLevel: 'intermediate' },
                            { id: 'presentation', name: 'Presentaci√≥n', icon: 'üìä', description: 'Presentaci√≥n corporativa principal', defaultDuration: 2, soundLevel: 'professional', lightingLevel: 'professional' },
                            { id: 'teambuilding', name: 'Team Building', icon: 'ü§ù', description: 'Actividades de equipo', defaultDuration: 3, soundLevel: 'intermediate', lightingLevel: 'intermediate' }
                        ]
                    },
                    {
                        id: 'fiesta',
                        name: 'Fiesta Privada',
                        icon: 'üéâ',
                        multiplier: 1.0,
                        parts: [
                            { id: 'setup', name: 'Montaje', icon: 'üîß', description: 'Preparaci√≥n del espacio', defaultDuration: 1, soundLevel: 'intermediate', lightingLevel: 'intermediate' },
                            { id: 'party', name: 'Fiesta', icon: 'üéâ', description: 'Celebraci√≥n principal', defaultDuration: 5, soundLevel: 'professional', lightingLevel: 'professional' }
                        ]
                    },
                    {
                        id: 'otro',
                        name: 'Otro',
                        icon: 'üìÖ',
                        multiplier: 1.0,
                        parts: [
                            { id: 'event', name: 'Evento', icon: 'üìÖ', description: 'Evento general', defaultDuration: 4, soundLevel: 'intermediate', lightingLevel: 'intermediate' }
                        ]
                    }
                ],
                servicePrices: {
                    sound: { basic: 100, intermediate: 200, professional: 350, premium: 600 },
                    lighting: { basic: 80, intermediate: 150, professional: 280, premium: 500 }
                }
            };

            // Limpiar y guardar
            localStorage.removeItem('advancedCalculatorConfig');
            localStorage.removeItem('calculatorConfig');
            localStorage.setItem('advancedCalculatorConfig', JSON.stringify(fixedConfig));

            log('‚úÖ Configuraci√≥n limpiada y reparada', 'pass');
            log('<h3>Resumen:</h3>');
            fixedConfig.eventTypes.forEach(e => {
                log(`‚úÖ ${e.icon} ${e.name}: ${e.parts.length} partes`, 'pass');
            });

            log('<h2 style="color: #4ec9b0;">üéâ REPARACI√ìN COMPLETADA</h2>', 'pass');
            log('<p><strong>Ahora click en "üìä Ir al Gestor" y verifica que TODO funcione</strong></p>', 'info');
            
            setTimeout(() => {
                if (confirm('¬øIr al gestor ahora?')) {
                    location.href = '/admin/calculator';
                }
            }, 1000);
        }

        // Auto-ejecutar al cargar
        window.onload = () => {
            log('<p><strong>P√°gina de diagn√≥stico cargada. Click en "üöÄ Ejecutar Todos los Tests"</strong></p>', 'info');
        };
    </script>
</body>
</html>
